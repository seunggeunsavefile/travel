<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>KakaoMap ì‹¤ìŠµ 3ë‹¨ê³„ - ì¹´í…Œê³ ë¦¬ ê²€ìƒ‰</title>
    <!-- Kakao Maps JS SDK: ì•± í‚¤ë¥¼ ì•„ë˜ YOUR_APP_KEY_HERE ë¡œ êµì²´í•˜ì„¸ìš” -->
    <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=b128209c9ae4dab493ade5f50b63bdcb&autoload=false&libraries=services,clusterer"></script>
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; font-family: Pretendard, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans KR', Arial; }
        header { padding: 14px 18px; border-bottom: 1px solid #eee; display:flex; gap:12px; align-items:center; flex-wrap: wrap; }
        header h1 { font-size: 18px; margin: 0 8px 0 0; }
        header .hint { color:#666; font-size: 13px; }
        .wrap { padding: 12px; max-width: 1100px; margin: 0 auto; }
        .row { display:flex; gap:8px; align-items:center; flex-wrap: wrap; margin-bottom:10px; }
        input[type="text"], select { padding: 10px 12px; border:1px solid #ddd; border-radius:10px; }
        input[type="text"] { flex: 1; min-width: 260px; }
        button { padding: 10px 14px; border:1px solid #ddd; background:#fafafa; border-radius:10px; cursor:pointer; }
        .map { width:100%; height:420px; border:1px solid #f0f0f0; border-radius: 12px; overflow: hidden; }
        .list { display:grid; gap:8px; margin-top: 10px; }
        .card { border:1px solid #eee; border-radius:12px; padding:10px; }
        .card h3 { margin: 0 0 6px; font-size: 15px; }
        .card p { margin: 2px 0; color:#555; font-size: 13px; }
        .small { font-size:12px; color:#777; }
        .legend { margin-top:8px; color:#666; font-size: 12px; }
    </style>
</head>
<body>
<header>
    <h1>KakaoMap ì‹¤ìŠµ 3ë‹¨ê³„</h1>
    <span class="hint">ì¹´í…Œê³ ë¦¬(ë°˜ê²½/í˜„ì¬ ì¤‘ì‹¬) + í´ëŸ¬ìŠ¤í„°ëŸ¬</span>
</header>
<div class="wrap">

    <!-- 3ë‹¨ê³„: ì¹´í…Œê³ ë¦¬ ê²€ìƒ‰ (ê´€ê´‘ì§€ AT4ëŠ” í•™ìƒ ê³¼ì œë¡œ ë‘˜ ìˆ˜ ìˆìŒ) -->
    <div class="row">
        <label class="small">ì¹´í…Œê³ ë¦¬</label>
        <select id="category">
            <option value="CE7" selected>ì¹´í˜(CE7)</option>
            <option value="FD6">ìŒì‹ì (FD6)</option>
            <option value="CS2">í¸ì˜ì (CS2)</option>
            <option value="PM9">ì•½êµ­(PM9)</option>
            <option value="SW8">ì§€í•˜ì² ì—­(SW8)</option>
            <option value="BK9">ì€í–‰(BK9)</option>
            <option value="PK6">ì£¼ì°¨ì¥(PK6)</option>
            <option value="OL7">ì£¼ìœ ì†Œ(OL7)</option>
            <option value="CT1">ë¬¸í™”ì‹œì„¤(CT1)</option>
            <!-- ê³¼ì œ: ê´€ê´‘ëª…ì†Œ(AT4) -->
        </select>
        <label class="small">ë°˜ê²½</label>
        <select id="radius">
            <option value="1000">1km</option>
            <option value="3000" selected>3km</option>
            <option value="5000">5km</option>
        </select>
        <button id="nearbyBtn">í˜„ì¬ ì¤‘ì‹¬ì—ì„œ ì°¾ê¸°</button>
        <label class="small"><input type="checkbox" id="autoRefresh" checked/> ìë™ ìƒˆë¡œê³ ì¹¨</label>
        <span id="centerCoords" class="small"></span>
    </div>

    <div id="map" class="map"></div>
    <div class="legend">ğŸŸ¢ ì¹´í…Œê³ ë¦¬ ê²€ìƒ‰ ê²°ê³¼ (í´ëŸ¬ìŠ¤í„°ë§ ì ìš©)</div>
    <div id="nearby" class="list"></div>

    <script>
        kakao.maps.load(function() {
            // ì§€ë„/í´ëŸ¬ìŠ¤í„°ëŸ¬/ì„œë¹„ìŠ¤
            const map = new kakao.maps.Map(document.getElementById('map'), {
                center: new kakao.maps.LatLng(37.5665, 126.9780),
                level: 6
            });
            const clusterer = new kakao.maps.MarkerClusterer({ map: map, averageCenter: true, minLevel: 7 });
            const places = new kakao.maps.services.Places();
            const infowindow = new kakao.maps.InfoWindow({ zIndex: 1 });

            // DOM
            const $nearby = document.getElementById('nearby');
            const $centerCoords = document.getElementById('centerCoords');
            const $category = document.getElementById('category');
            const $radius = document.getElementById('radius');
            const $autoRefresh = document.getElementById('autoRefresh');

            // ìƒíƒœ
            let markers = [];

            // ìœ í‹¸
            function updateCenterLabel() {
                const c = map.getCenter();
                $centerCoords.textContent = `center: ${c.getLat().toFixed(5)}, ${c.getLng().toFixed(5)}`;
            }
            function clearMarkers() { markers.forEach(m => m.setMap(null)); markers = []; clusterer.clear(); }
            function renderList(items) {
                $nearby.innerHTML = '';
                items.forEach((p, idx) => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.innerHTML = `
            <h3>${idx+1}. ${p.place_name}</h3>
            <p>${p.road_address_name || p.address_name || ''}</p>
            <p class="small">ì¢Œí‘œ: ${p.y}, ${p.x}</p>
            <a href="${p.place_url}" target="_blank" class="small">ìƒì„¸ë³´ê¸°</a>
          `;
                    card.onclick = () => map.panTo(new kakao.maps.LatLng(p.y, p.x));
                    $nearby.appendChild(card);
                });
            }

            updateCenterLabel();
            kakao.maps.event.addListener(map, 'center_changed', updateCenterLabel);

            // ì¹´í…Œê³ ë¦¬ ê²€ìƒ‰
            function searchByCategory() {
                infowindow.close();
                clearMarkers();
                const center = map.getCenter();
                const radius = parseInt($radius.value, 10);
                const code = $category.value; // ì˜ˆ: CE7(ì¹´í˜)
                const options = { location: center, radius: radius };

                places.categorySearch(code, function(data, status) {
                    if (status !== kakao.maps.services.Status.OK) {
                        alert('ì£¼ë³€ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
                        renderList([]);
                        return;
                    }
                    const newMarkers = [];
                    data.forEach(p => {
                        const pos = new kakao.maps.LatLng(p.y, p.x);
                        const marker = new kakao.maps.Marker({ position: pos });
                        newMarkers.push(marker);

                        kakao.maps.event.addListener(marker, 'click', function() {
                            const html = `
                <div style="padding:8px 10px">
                  <div style="font-weight:600;margin-bottom:4px">[${code}] ${p.place_name}</div>
                  <div style="font-size:12px;color:#555">${p.road_address_name || p.address_name || ''}</div>
                  <a href="${p.place_url}" target="_blank" style="font-size:12px">ìƒì„¸ë³´ê¸°</a>
                </div>`;
                            infowindow.setContent(html);
                            infowindow.open(map, marker);
                        });
                    });
                    markers = newMarkers;
                    clusterer.addMarkers(markers);
                    renderList(data);
                }, options);
            }

            // ì´ë²¤íŠ¸
            document.getElementById('nearbyBtn').onclick = searchByCategory;
            kakao.maps.event.addListener(map, 'dragend', () => { if ($autoRefresh.checked) searchByCategory(); });

            // ì´ˆê¸° 1íšŒ ê²€ìƒ‰
            searchByCategory();
        });
    </script>

</div>
</body>
</html>
